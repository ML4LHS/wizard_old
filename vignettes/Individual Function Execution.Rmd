---
title: "Introduction"
author: "Adharsh Murali"
date: "`r Sys.Date()`"
output: rmarkdown::github_document
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# Installation

```{r eval=FALSE}

# install.packages("devtools")
library("devtools")
devtools::install_github("smeyer-umich/wisard", auth_token = "725cd269dcfd0b64fdeb5aa51a3e0a52193fdd3c")
```


```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)

```

# 1) Load in the fixed data and temporal data

```{r}
library(tidyverse, quietly = TRUE)

temporal_file = file.path("../inst/extdata/temporal_data.csv")
fixed_file = file.path("../inst/extdata/fixed_data.csv")

temporal_data =  data.table::fread(temporal_file) %>% 
  dplyr::mutate(time = time %>% lubridate::as_datetime())

temporal_data %>% head()

# The fixed data should of type tibble, data.frame or disk frame.
fixed_data = data.table::fread(fixed_file) %>% 
  dplyr::mutate(time = admit_time %>% lubridate::as_datetime(), outcome = outcome %>% lubridate::as_datetime()) %>% 
  as.data.frame()

fixed_data %>% head()

```

# 2) Generating the categorical column names. 

```{r}
# input temporal_dataframe and the return is also a temporal_data frame.
# The function columns the categorical columns as a variable with a binary value.
temporal_data_2 = wisard::categorical_col_names_generator(temporal_data = temporal_data)

temporal_data_2
```

# 3) Identifying the unique variables in the temporal dataset.

```{r}
# The input parameter is the temporal dataframe and the output is unique variables and their categories
unique_columns = wisard::unique_variables(data = temporal_data)
unique_columns
```

# 4) Calling in the date_to_time function to convert the timestamps in the temporal data to Number relative to the admit time or initial time.

```{r}
# To convert the user argument which is a period object to a numeric value. It returns a list of values.
period_measure = wisard::hour_to_number(window_size = lubridate::hours(6),lookback = lubridate::hours(48),lookahead = lubridate::hours(48),step = hours(3))
# The input parameters are:
#1)temporal_data
#2) Fixed data frame
#3) units : unit of the period object for eg.in hours(6) the unit is hours and seconds(6) unit is seconds.
temporal_data = wisard::date_to_time(temporal_data = temporal_data, fixed_data = fixed_data, units = period_measure$units)
```

# 4) Generating the column names based on user specified summary stats.

```{r}
# The input parameters are:
#1) temporal dataframe.
#2) feature stat based on category
column_names = wisard::colnames_generator(temporal_data,
                               feature_stat = list(labs = c('min', 'mean', 'max'),
                                                   meds = ('min')
                               ),
                               lag_display = list("meds" = T,"labs" = T),
                               lag_compute = list("meds" = c("both"),
                                                  "labs" = c("prop")),
                               #lagged_feature_stat = list(labs = c('min', 'mean')),
                               
                               lookback = list("meds" = hours(7),"labs" = hours(48)),
                               window_size = list("meds" = hours(1),"labs" = hours(6)) )
# returns a list of column names
all_variable_to_create = column_names[[1]]
```


# 5) Finally calling in the lagged feature generation function.

```{r}

result_frame = wisard::dummy_wisard(temporal_data = temporal_data,all_variable_to_create = all_variable_to_create,lag_variable_to_create = lag_variable_to_create,window_size = period_measure$window_size,outcome_var = NULL,outcome_stat = list("min"),lookahead = period_measure$lookahead,lookback = period_measure$lookback,step = period_measure$step,lag_display = list("meds" = T,"labs" = T),
lag_comp = list("meds" = "both", "labs" = "prop"),recent_only = T,impute = T)
result_frame %>% head()
```
